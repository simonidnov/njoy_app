var app={ip:"http://10.3.141.1:3000",activities:null,callback:null,infos:{user_name:"",uuid:"",regis:!1,users:[]},current_video:{name:"",position:0,duration:0,volume:1},socket:null,initialize:function(){"undefined"==typeof cordova?this.onDeviceReady():document.addEventListener("deviceready",this.onDeviceReady.bind(this),!1)},onDeviceReady:function(){this.receivedEvent("deviceready"),ui.init(),document.addEventListener("offline",this.is_offline,!1),window.addEventListener("batterylow",this.onBatteryLow,!1)},load_activities:function(e){$.getJSON(app.ip+"/activities.json",function(){console.log("success")}).done(function(){console.log("second success")}).fail(function(){console.log("error")}).always(function(s){if(console.log("complete"),void 0!==s.activities)app.activities=s,e("success");else if(void 0!==s.responseText){try{console.log("e.responseText ",s.responseText),a=JSON.parse(s.responseText),e("success"),console.log("a ",a)}catch(s){return e("fail"),!1}app.activities=a}})},is_offline:function(){ui.check_wifi()},onBatteryLow:function(){ui.battery_low()},set_video_assets:function(){$(".video_asset #seeker").on("change",function(e){var s=Math.round(app.current_video.duration/100*$("#seeker").val());console.log("seek to ",s),app.socket.emit("njoy",{status:"position_video",position:s})}),$(".video_asset #volume").on("change",function(e){var s=Math.abs($(".video_asset #volume").val()/100).toFixed(1);console.log("set volume ::::::::::::::::: ",s),app.socket.emit("njoy",{status:"volume_video",volume:s})}),$(".video_asset #play_pause_button").off(ui.event).on(ui.event,function(e){"img/play_icon.svg"===$(".video_asset #play_pause_button img").attr("src")?app.socket.emit("njoy",{status:"resume_video"}):app.socket.emit("njoy",{status:"pause_video"}),e.preventDefault(),console.log("play pause video")}),$(".video_asset #quit_video_button").off(ui.event).on(ui.event,function(){app.socket.emit("njoy",{status:"stop_video"})})},set_audio_assets:function(){$(".audio_asset #play_pause_button").off(ui.event).on(ui.event,function(e){"img/play_icon.svg"===$(".audio_asset #play_pause_button img").attr("src")?app.socket.emit("njoy",{status:"audio_resume"}):app.socket.emit("njoy",{status:"audio_pause"}),e.preventDefault(),console.log("play pause audio")}),$(".audio_asset #mute_button").off(ui.event).on(ui.event,function(e){"img/audio_icon.svg"===$(".audio_asset #mute_button img").attr("src")?app.socket.emit("njoy",{status:"audio_volume"}):app.socket.emit("njoy",{status:"audio_mute"}),e.preventDefault()}),$(".audio_asset #stop_audio_button").off(ui.event).on(ui.event,function(){app.socket.emit("njoy",{status:"audio_stop"})}),$(".audio_asset #fast_forward").off(ui.event).on(ui.event,function(){app.socket.emit("njoy",{status:"fast_forward_audio"})}),$(".audio_asset #fast_backward").off(ui.event).on(ui.event,function(){app.socket.emit("njoy",{status:"fast_backward_audio"})})},init_socket:function(e){this.callback=e,app.infos.uuid=(new Date).getTime(),app.socket_callback=function(e){console.log(e)},app.socket=io(this.ip,{transports:["websocket","xhr-polling"]}),app.socket.on("error",function(e){app.callback({status:"error_socket",datas:e})}),app.socket.on("connect_failed",function(e){app.callback({status:"connect_failed"})}),app.socket.on("connect",function(e){app.callback({status:"socket_connected"})}),app.set_video_assets(),app.set_audio_assets(),app.socket.on("njoy",function(e){switch(e.status){case"activities":app.infos.activities=e.activities;break;case"video_started":app.set_video_assets(),$(".video_asset #play_pause_button img").attr("src","img/pause_icon.svg"),$(".video_asset").addClass("started"),$(".screen").css({height:window.innerHeight-$("header").height()-$(".video_asset").height(),overflow:"hidden"});break;case"video_pause":$(".video_asset #play_pause_button img").attr("src","img/play_icon.svg");break;case"video_resume":$(".video_asset #play_pause_button img").attr("src","img/pause_icon.svg");break;case"video_stopped":$(".screen").css({height:window.innerHeight-$("header").height(),overflow:"hidden"}),$(".video_asset").removeClass("started");break;case"video_position":console.log("position_video ",e);break;case"video_seek":console.log("video_seek ",e);break;case"video_volume":console.log("video_volume :::: ",e.volume),app.current_video.volume=e.volume,$("#volume").val(100*parseFloat(e.volume));break;case"progress_video":app.current_video.position=e.position,app.current_video.duration=e.duration,$(".video_asset #seeker").val(e.position/e.duration*100);break;case"audio_played":app.set_audio_assets(),$(".audio_asset #mute_button img").attr("src","img/audio_icon.svg"),$(".audio_asset #play_pause_button img").attr("src","img/pause_icon.svg"),$(".audio_asset").addClass("started"),$(".screen").css({height:window.innerHeight-$("header").height()-60,overflow:"hidden"});break;case"audio_paused":$(".audio_asset #play_pause_button img").attr("src","img/play_icon.svg");break;case"audio_play":$(".audio_asset #play_pause_button img").attr("src","img/pause_icon.svg");break;case"audio_stopped":$(".screen").css({height:window.innerHeight-$("header").height(),overflow:"hidden"}),$(".audio_asset").removeClass("started");break;case"audio_muted":$(".audio_asset #mute_button img").attr("src","img/audio_icon.svg");break;case"audio_volumed":$(".audio_asset #mute_button img").attr("src","img/mute_icon.svg");break;case"drawer":case"fast_forward":case"fast_backward":case"video_audio":break;case"teams":app.teams=e.datas.teams,ui.set_teams(),console.log("teams ",e.datas.teams);break;case"error":ui.popin({title:e.datas.title,message:e.datas.message,buttons:[{label:"OK"}]},function(e){})}void 0!==e.teams&&(console.log("teams is defined :::: ",e.teams),app.teams=e.teams,ui.set_teams()),app.socket_callback(e)}),app.socket.on("njoy_"+app.infos.uuid,function(e){switch(e.status){case"animations":break;case"login_success":app.infos.users=e.datas.users,"undefined"!==_.where(app.infos.users,{uuid:app.infos.uuid})[0].regis&&"true"===_.where(app.infos.users,{uuid:app.infos.uuid})[0].regis&&(app.infos.regis=!0);break;case"login_error":app.infos.users=e.datas.users}void 0!==e.datas.animations&&(animations=e.datas.animations),app.socket_callback(e)}),app.socket.emit("njoy",{status:"new"}),app.socket.on("chat_message",function(e){$("#messages").append($("<li>").text(JSON.stringify(e)))}),window.onbeforeunload=function(e){app.socket.emit("njoy",{status:"disconnect",user_name:app.infos.user_name,uuid:app.infos.uuid})}},receivedEvent:function(e){}};app.initialize();