var app={ip:"http://10.3.141.1:3000",activities:null,callback:null,infos:{user_name:"",uuid:"",regis:!1,users:[]},socket:null,initialize:function(){document.addEventListener("deviceready",this.onDeviceReady.bind(this),!1)},onDeviceReady:function(){this.receivedEvent("deviceready"),ui.init(),document.addEventListener("offline",this.is_offline,!1),window.addEventListener("batterylow",this.onBatteryLow,!1)},load_activities:function(e){$.getJSON(app.ip+"/activities.json",function(){console.log("success")}).done(function(){console.log("second success")}).fail(function(){console.log("error")}).always(function(t){if(console.log("complete"),"undefined"!=typeof t.activities)app.activities=t,e("success");else if("undefined"!=typeof t.responseText){try{console.log("e.responseText ",t.responseText),a=JSON.parse(t.responseText),e("success"),console.log("a ",a)}catch(t){return alert(t),e("fail"),!1}app.activities=a}})},is_offline:function(){ui.check_wifi()},onBatteryLow:function(){ui.battery_low()},init_socket:function(e){this.callback=e,app.infos.uuid=(new Date).getTime(),app.socket_callback=function(e){console.log(e)},app.socket=io(this.ip,{transports:["websocket","xhr-polling"]}),app.socket.on("error",function(e){app.callback({status:"error_socket",datas:e})}),app.socket.on("connect_failed",function(e){app.callback({status:"connect_failed"})}),app.socket.on("connect",function(e){app.callback({status:"socket_connected"})}),app.socket.on("njoy",function(e){switch(e.status){case"activities":app.infos.activities=e.activities}app.socket_callback(e)}),app.socket.on("njoy_"+app.infos.uuid,function(e){switch(e.status){case"animations":break;case"login_success":app.infos.users=e.datas.users,"undefined"!==_.where(app.infos.users,{uuid:app.infos.uuid})[0].regis&&"true"===_.where(app.infos.users,{uuid:app.infos.uuid})[0].regis&&(app.infos.regis=!0);break;case"login_error":app.infos.users=e.datas.users}"undefined"!=typeof e.datas.animations&&(animations=e.datas.animations),app.socket_callback(e)}),app.socket.emit("njoy",{status:"new"}),app.socket.on("chat_message",function(e){$("#messages").append($("<li>").text(JSON.stringify(e)))}),window.onbeforeunload=function(e){app.socket.emit("njoy",{status:"disconnect",user_name:app.infos.user_name,uuid:app.infos.uuid})}},receivedEvent:function(e){console.log("Received Event: "+e)}};app.initialize();