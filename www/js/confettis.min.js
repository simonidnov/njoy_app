var canvas_confettis,ctx,W,H,deactivationTimerHandler,reactivationTimerHandler,animationHandler,mp=20,particles=[],angle=0,tiltAngle=0,confettiActive=!0,animationComplete=!0,_stopped=!1,confettis=function(){function t(t){this.x=Math.random()*W,this.y=Math.random()*H-H,this.r=a(100,250),this.d=Math.random()*mp+50,this.color=t,this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncremental=.07*Math.random()+.05,this.tiltAngle=0,this.draw=function(){return ctx.beginPath(),ctx.lineWidth=this.r/2,ctx.strokeStyle=this.color,ctx.moveTo(this.x+this.tilt+this.r/4,this.y),ctx.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),ctx.stroke()}}function n(){$("#stopButton").click(d),$("#startButton").click(f)}function i(t){canvas_confettis=document.getElementById(t),ctx=canvas_confettis.getContext("2d"),W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H}function e(){particles=[],results=[],animationComplete=!1;for(var n=0;n<mp;n++){var i=w.getColor();particles.push(new t(i))}h()}function o(){ctx.clearRect(0,0,W,H);for(var t,n=[],i=0;i<mp;i++)t=i,n.push(particles[t].draw());return r(),n}function a(t,n){return Math.floor(Math.random()*(n-t+1)+t)}function r(){var t,n=0;angle+=.01,tiltAngle+=.1;for(var i=0;i<mp;i++){if(t=particles[i],animationComplete)return;!confettiActive&&t.y<-15?t.y=H+100:(l(t,i),t.y<=H&&n++,c(t,i))}0===n&&u()}function c(t,n){(t.x>W+20||t.x<-20||t.y>H)&&confettiActive&&(n%5>0||n%2==0?s(t,Math.random()*W,-10,Math.floor(10*Math.random())-20):Math.sin(angle)>0?s(t,-20,Math.random()*H,Math.floor(10*Math.random())-20):s(t,W+20,Math.random()*H,Math.floor(10*Math.random())-20))}function l(t,n){t.tiltAngle+=t.tiltAngleIncremental,t.y+=(Math.cos(angle+t.d)+3+t.r/2)/2,t.x+=Math.sin(angle),t.tilt=15*Math.sin(t.tiltAngle-n/3)}function s(t,n,i,e){t.x=n,t.y=i,t.tilt=e}function h(){W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H,function t(){return animationComplete?null:(animationHandler=requestAnimFrame(t),o())}()}function m(){clearTimeout(reactivationTimerHandler),clearTimeout(animationHandler)}function d(){confettiActive=!1,m()}function u(){animationComplete=!0,null!=ctx&&ctx.clearRect(0,0,W,H)}function f(){m(),u(),reactivationTimerHandler=setTimeout(function(){confettiActive=!0,animationComplete=!1,e()},100)}var w={colorOptions:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],colorIndex:0,colorIncrementer:0,colorThreshold:10,getColor:function(){return this.colorIncrementer>=10&&(this.colorIncrementer=0,this.colorIndex++,this.colorIndex>=this.colorOptions.length&&(this.colorIndex=0)),this.colorIncrementer++,this.colorOptions[this.colorIndex]}};this.initConfettis=function(t){i(t),n(),e(),$(window).resize(function(){W=window.innerWidth,H=window.innerHeight,canvas_confettis.width=W,canvas_confettis.height=H})},this.start_confettis=function(){confettiActive||f()},this.stop_confettis=function(){d(),_stopped=!0},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}};